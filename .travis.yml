os:
  - osx

osx_image: xcode11

language: 
 - cpp
 - python

addons:
  homebrew:
    packages:
      - graphviz
      - cmake
      - boost
      - doxygen
      - opencv
      - fmt
      - ffmpeg
      - openblas
      - lcov
      - portaudio
      - libsndfile

before_install:
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then python3 -m venv tomcat; fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then source tomcat/bin/activate; fi

install:
  - pip install exhale recommonmark sphinx-rtd-theme
  - cd external && curl -O http://dlib.net/files/dlib-19.17.tar.bz2 
    && tar -xvjf dlib-19.17.tar.bz2 && cd ../

env:
  - TOMCAT=$TRAVIS_BUILD_DIR

script:
  - ./tools/download_tomcat_data.sh
  - mkdir build && cd build && cmake .. -DBUILD_DOCS=ON && make -j test && cd ../
  - cd build && ./bin/test --mission ../external/malmo/sample_missions/default_world_1.xml && cd ../
  - cd build && make docs


after_success:
  - lcov -d build/tests/CMakeFiles/test.dir -d build/src/CMakeFiles/tomcat.dir -c -o coverage.info
  - lcov -e coverage.info '*tomcat/src*' -o coverage.info
  - bash <(curl -s https://codecov.io/bash) -f coverage.info

deploy:
  local-dir: build/docs
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  on:
    branch:
      - master
      - website
