os:
  #- osx
  - linux

dist: bionic
#osx_image: xcode11

services:
  -xvfb

language: 
 - cpp
 - python
 - java

before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start

env:
  - TOMCAT=$TRAVIS_BUILD_DIR

script:
  - ./tools/install.sh
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export JAVA_HOME=$(/usr/libexec/java_home -v"1.8"); fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./tools/run_session.sh; fi
  - cd ${TOMCAT}/build && make docs && cd ../


after_success:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      lcov -d build/tests/CMakeFiles/test.dir -d build/src/CMakeFiles/tomcat.dir -c -o coverage.info
   && lcov -e coverage.info '*tomcat/src*' -o coverage.info
   && bash <(curl -s https://codecov.io/bash) -f coverage.info; fi

deploy:
  local-dir: build/docs
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN
  on:
    branch:
      - master
      - website
