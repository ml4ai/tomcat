\chapter{Probabilistic modeling of team coordination}
\label{ch:pgm}
\textbf{Paulo Soares, Kobus Barnard, Emily Butler}

\section{Introduction}
Human teams are interpersonal dynamic systems, where the individual team members
become subsumed by the collective whole in support of some shared goal or
function \citep{nowak2020insync, cooke2013Ainteractive, eiler2017interaction, fusaroli2014dialog, gorman2010team, wiltshire2017problem, wiltshire2019multiscale}.
All higher-order team behavior, such as cooperation or competition, emerges from
coordination, which refers to causal interdependencies over time both within and
between the individual team members \citep{butner2014modeling}. At the individual
level, there are a number of sub-processes within each person, such as biology,
attention, cognition, emotion and motor behavior that mutually influence each
other to give rise to the person’s overall state at a given time \citep{butler2011temporal,butler2017emotions}. Similarly, at the interpersonal level, the individuals interact with each
other to give rise to the team’s overall state \citep{nowak2020insync, butler2011temporal, butler2017emotions, cooke2013Binteractive, gorman2010team, letsky2008macrocognition}.

One challenge for predicting team behavior and outcomes is that coordination
within the system, at both individual and collective levels, often results in
non-linear state changes over time. For example, a team may be unsuccessfully
trying to reach an agreement until one member reframes the problem in a way that
suddenly broadens everyone’s perspective, leading to immediate group consensus.
The non-linear change in the team’s state of agreement could be predicted by the
first person’s increased mental coordination in their mapping of the problem
(increased within-person coordination), which colloquially might be described as
“having the pieces fall into place,” followed by the team’s increased group
coordination as all members adopt the new perspective (increased between-person
coordination). Thus being able to recognize ongoing changes in coordination (in
this example in the domain of mental contents) could help an artificially
intelligent agent predict subsequent non-linear changes in team states and
performance outcomes. 

One important aspect of social coordination is that it is not mode- specific
\citep{eiler2017interaction}. Instead, coordination can be observed at every level of
the system, including neural, physiological, motor, perceptual, cognitive,
affective and linguistic levels simultaneously. It can also be observed at
multiple time-scales \citep{wiltshire2019multiscale}. For example, during a
conversation, neural events transpire on the order of milliseconds, speech
production and gestures over seconds, and the conversation itself on the order
of minutes \citep{hasson2012brain}. As such, observing coordination for the
purpose of prediction should be possible at any time resolution and any
modality, although different modes will change at different rates and thus must
be assessed at different time resolutions. For example, during a conversation
coordination between the electrical activity of people’s brains may be best
observed in milliseconds, while coordination of the semantic content of their
speech may be best observed at the level of speech turns.

Social coordination has been operationalized in many ways, often with approaches
that are mode or time-resolution specific. We prefer a more general approach,
since the same representation can be used to index coordination for any aspect
of the interpersonal system, from individual brain activity to collective
behavior sequences. One advantage of this for developing a socially intelligent
artificial agent is that the agent can learn about coordination from any
available observable information, which has important real-world consequences
for how useful such an agent will be, since it will not be constrained to
situations similar to those in which it is developed. The fundamental concept
that needs to be captured by a general representation of coordination is the
predictive interdependencies over time among the components of the system. See
the “Modeling” section below for the details of our representation.

We also prefer measures that are easily interpretable. Although coordination
should be observable from any measure of the interpersonal system, some measures
will map more closely to intuitive domains of coordination than others. For
example, coordination of speech behavior is theoretically observable from any
derived measure of vocal signals during a conversation. Along these lines, work
with natural language processing has made use of dozens of automatically
extracted features from speech for categorizing a broad range of targets, such
as personality types or emotional expression \citep{eyben2010opensmile}. Although
successful categorization has been achieved using various subsets of the
features, it is unclear what aspect of human behavior contributed to the
results, making it impossible to go from the results to theoretically based
interventions. For the present research, therefore, we focus on coordination of
two vocal features that map directly to pitch and loudness of human speech (see
Methods for details), both of which could be targeted by an intervention as
simple as asking a person to speak softly. 

Finally, we also prefer models that are predictive and interpretable. XXXXXXX

\section{Hypotheses}
The proposed research will use data from ASIST Study 3, to be conducted in the Spring of 2022. Participants will take part in 3-person teams and will play a game where they attempt to save virtual victims in a Mindcraft Search and Rescue scenario. We will test the following hypotheses:

1) Including coordination as a node in a probabilistic graphical model
\textbf{will improve} prediction of team process and effect measures (see Measures for details)  as compared to a comparable model that does not include coordination.

2) Teams with higher coordination will have higher scores on measures of team process and effects (see Measures for details) than teams with lower coordination.

3) The agent has a set of three interventions to encourage oral communication among
team members. Teams where the agent intervenes will have higher coordination,
and higher scores on measures of team process and effects (see Measures for
details), than teams where the agent does not do this. For teams selected for
intervention will get interventions contingent on activities and also on how
many interventions have been done so far to avoid intervening too much.  The
interventions are:
\begin{enumerate}
    \item
    If a team member places a marker block (a form of communication provided in
    the game) but does not say they did, then the agent will suggest that they
    tell their team members that they placed it. 
    \item
    For some teams, if a team member needs help (to stabilize a victim or exit a
    blocked room) but does not say they do, then the agent will suggest that
    they tell their team members that they need assistance. 
    \item
    For some teams, if a team member asked for help but did not get a reply from
    any of the other team members, then the agent will suggest that they tell
    the others again that help is needed. 
\end{enumerate}

\section{Approach}

\subsection{Design}
Our analyses to test Hypotheses 1 and 2 will make use of data from all of the
participants in the study (e.g., all possible between- and within- participant
conditions). As such, testing whether including coordination in the model
improves prediction of team process and effects measures (Hypothesis 1) and
testing the association between coordination and team process and effects
measures (Hypothesis 2) will each be based on 224 missions (8 conditions X 14
teams X 2 missions). Our analyses to test Hypothesis 3 will make use of data
from the ``No-Advisor” and ``UAZ-Agent” conditions, and so testing the effect of
our intervention (Hypothesis 3) will be based on 28 ``No-Advisor” control
missions (14 teams X 2 missions) compared to 28 ``UAZ-agent” intervention
missions (14 teams X 2 missions).

\subsection{Measures}
\textbf{Coordination indicators}. As discussed above, team coordination is
theoretically observable across modalities and time resolutions for all of the
components of the interpersonal system. Given the constraints of what will be
measured for ASIST Study 3, we will focus on two vocalic measures that are to be
provided in real-time (every 10ms) during the missions as indicators for
modeling linguistic coordination. The first, ``F0final\_sma" is the smoothed
moving average of fundamental frequency. It corresponds to a speaker’s pitch.
The second, ``wav\_RMSenergy\_sma" is the Root Mean Square energy measure, which
provides an estimate of the intensity of the sound, which correlates with what
humans perceive as loudness. 

\textbf{Team Process and Effects Measures}. We will include 5 team process
measures and 2 team effects measures, each taken from the full set of measures
that will be available for ASIST Study 3. This subset was chosen due to either:
1) having theoretical connections to coordination (i.e., synchronization,
coordinative communications, belief differences) or 2) involving the use of
markers for communication, which is the direct target of our intervention
(threat room and victim type communication), or 3) representing a global measure
of team effectiveness (score and error rate).

The team process outcome measures are:
\begin{itemize}
    \item
    ASI-M2 Synchronization (e.g., inter-subtask latency); \textbf{Measure}: Mean latency
    between subtasks of teamwork tasks per trial. Specifically, the mean latency
    between victim discovery and victim rescue computed as the average over all
    correctly rescued victims (time of delivery of victim to correct rescue site
    - time victim was discovered). Where time victim was discovered = the
    earliest (or minimum) of (1) Transporter signalling device for the room
    containing the victim, or (2) Medic completes stabilization of the victim.
 
    \item
    ASI-M5 Coordinative Communications; \textbf{Measure}: A quantitative characterization
    of the complexity of team communication using entropy in the dynamical
    system. Entropy is defined as the level of irregularity in the flow of
    communications between team members.(i.e., Team Communication Dynamics).
    Typical components of the measure are: (1) Intensity and distributions of
    team communications are calculated using calculations of over message
    frequency, duration, and intra-team variance. (2) Temporal patterns of team
    communications are captured using timestamped communication events and
    analyzed with recurrence quantification analysis.

    \item
    Rutgers Threat Room Communication AC; \textbf{Measure}: \% of threat rooms that had a
    threat room marker block outside its entrance at some point during the
    mission.  

    \item
    Rutgers Victim Type Communication AC; \textbf{Measure}: count of victim
    type marker blocks placed near the correct type of A or B victims.
    
    \item
    Rutgers Belief Difference AC; \textbf{Measure}: entropy of beliefs about victim
    distribution by comparing three models in which (1) players share
    information perfectly, (2) players don't share any information, and (3)
    players only share information via marker blocks.  
\end{itemize}

The team effects measures are: 

\begin{itemize}
    \item
    ASI-M1 ASI Utility (SAR game score) 
    \item

    ASI-M3 Error Rate; \textbf{Measure}: Percentage of
    subtasks of teamwork tasks that are completed per trial, measured as below.
    Specifically, the percentage of discovered victims who are not evacuated.
    Measure = 1 - (\# victims rescued / \# victims discovered)
\end{itemize}

\subsection{Modeling}
    We develop a probabilistic model for measurement outcomes. In addition to
    reflecting an explanatory story, a key property of this approach relevant to
    evaluation as discussed below is all estimates are probability
    distributions. In needed, these can be distilled into point estimates by
    either averaging the distribution (MMSE loss) or using the maximum (MAP
    loss). 

    Our probabilistic model for this experiment (see  Figure~\ref{fig:pgm})
    models outcome measures, $M^i$, conditioned on a coordination latent construct, $C$. 
%
    \begin{figure}
    \label{fig:pgm}
    \includegraphics[width=6in]{images/prereg-pgm.pdf}
    \caption{Probabilistic graphical model (pgm) for investigating coordination.
    Circles (nodes) are stochastic variables. 
    Open circles are latent variables, shaded circles are potentially observed
    variables, and arrows represent variables conditioned on parents.
    Coordination, $C$, is posited to influence team efficacy measures, $M^i$.
    We do not use plate notation here because the conditioning arrows are
    measure specific). These are different linear functions learned from data with potentially
    different emission distributions (e.g., normal or Poisson), depending on the
    measurement construct. \\
    $~~~~~~~~$ Coordination is exhibited by variables influencing other variables in the
    next time step. We do not draw all possible arrows here, because, for
    vocalics, we assume that all  such influence comes from the previous speaker.
    Here we illustrate person 1 speaking, followed by person 2, and then person 3.  }
    \end{figure}
%
    The distributions $p(M^i|C)$ are typically linear functions learned from data
    with normal or Poisson emission distribution. Using a simple prior on $C$,
    provides a baseline model.

    \textbf{Coordination.}
    We would like to study the effect of including coordination in this model.
    We are developing a comprehensive probabilistic model for coordination, with
    a simple case exhibited as part of Figure~\ref{fig:pgm}.  While in the
    general case coordination influences multiple diverse modalities at
    different time scales, here we consider a single time scale and two vocalic
    features.  Our underlying axiom is that higher coordination is associated
    with causally driven increased mutual information (statistical dependence)
    between relevant observed variables. Here we consider latent attributes for
    vocalic style for person $p$, denoted by $A^{p}$, which has as evidence,
    $O^{p,1}$, being the mean of normally distributed pitch of speech over a
    speech turn and similarly $O^{p,2}$ for speech intensity.  We further assume
    that the speech style of each person is only influenced by the previous
    speaker.

    If person 2 speaks after
    person 1, then the degree that their vocalic style follows that of person 1
    indicates coordination. Formally, we blend the non-coordinated distribution
    mean, $\mu^2_t$, for the second person, with the fully dependent mean,
    $\mu^1_t$, for the mean for the second person at time $t+1$ by
    \begin{equation}
    \mu^2_{t+1} = (1-c) \mu^2_t + c\mu^1_t ~.
    \end{equation}

    To pre-register a single approach, we model coordination as being
    constant for the second half of the second
    trial. This allows for the team to develop some rapport and interventions to
    have an effect. 

\subsection{Intervention}





\section{Evaluation}

\textbf{Hypothesis 1}: modeling coordination improves outcome prediction.  For
hypothesis 1 we train two different models (with and without coordination) on
the same training sets in the cross validation splits. We then apply that model
to held out data. The result in either case is a distribution for each outcome
variable. Given the actual value of the outcome variable treated as a real
number, we will evaluate predictive accuracy by using the mean of the
distribution (MMSE loss) compared to the actual value and compute the squared
error over all test splits in a leave one out cross validation scenario. For
completeness, for any categorical outcomes we would compare the value with
maximal probability with the observed one. 

\textbf{Hypothesis 2}: increased coordination predicts higher outcome scores.
Here we are interested in the learned model. In particular, we posit that the
slopes in the sub-models for the measures, i.e., $p(M^i|C)$ will be positive. We
will estimate the posterior distribution of those slopes over relevant data. The
mean and variance of that distribution will give some idea as to the validity of
the claim that coordination and a particular measure are positively correlated.
Sampling this distribution will reveal intervals that capture the probability
that this is valid within various ranges. 

\textbf{Hypothesis 3}: intervening on team communication predicts higher
coordination and SAR game scores. Here we have two distinct data cases. Each leads to
a probability distribution for coordination and score. Specifically, each run
contributes multiple samples to one of those distributions. We sample those
distributions to evaluate the hypotheses. Intuitively, it is easy to estimate
how often the statement is true ignoring the effect size, and the expected
difference, and the probability that it exceeds a desired value.  




