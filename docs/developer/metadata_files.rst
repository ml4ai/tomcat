Working with .metadata files
============================


.. toctree::
   :maxdepth: 1
   :caption: Contents:

In this writeup, we will describe the `.metadata` files produced by the TA3
testbed and how to work with them.

A `.metadata` file contains all the messages that were published on the MQTT
message bus (if you are not familiar with the concept of a message bus, see
`here`_ for a brief introduction) during a particular trial.

The first line of a `.metadata` file contains metadata about the trial itself,
and is generated by the TA3-developed mechanism that exports the data from the
Elasticsearch database in which the messages are stored. This metadata is also
used by the TA3 application that can be used to import .metadata files into an
Elastic database. For now, ToMCAT team members can ignore this line.

The subsequent lines of the file are the messages published on the bus during a
trial. Each line of the file corresponds to a single message. The messages are
in JSON format, with three components: `header`, `msg`, and `data`.

In the rest of this writeup, we use the following convention to refer to values
in JSON objects. The value stored at a top-level key named `key1` may be referred
to as `.key1`. For nested JSON objects, we extend this pattern.

The `header` portion contains the timestamp of when the message was published
(`timestamp`), the type of message (`message_type`), and a version number
(`version`) that tells downstream applications how to parse the `.msg` portion.

The `.msg` contains additional metadata such as the experiment ID
(`experiment_id`), the trial ID (`trial_id`)



.. _here: message_bus
