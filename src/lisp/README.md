SAR PDDL Domains/Lisp files
===========================
The folder contains all files pertaining to our Search and Rescue planning domains as well as 
our efforts to create a plan recognition algorithm. The main files required for running the domains 
and problem definitions are in Common Lisp (using the .lisp extension).
There are also other minor files serving as data and utility files as well
python code for data manipulation and experiments related to plan recognition and prediction.

To run the domain files (and any .lisp files), it is assumed that you have Common Lisp (preferably
Steel Bank Common Lisp) installed along with quicklisp and SHOP3. 

The SAR Individual Domain
-------------------------
The Search and Rescue individual planning domain is written in a file called `sar-individual-domain.lisp` using the SHOP3 common
Lisp library. Along with the domain file there are two other lisp files
`sar-individual-test-prob.lisp` and `sar-individual-test-prob-grapher.lisp`
which are scripts that set-up a SAR domain problem definition and call on
`sar-individual-domain.lisp` to generate plan trees using SHOP3. 

`sar-individual-test-prob.lisp` can be called from the command line by with the
following command,

`$ sbcl --load sar-individual-test-prob.lisp --quit`

This currently generates a txt file, `sar-plan-trees.txt`, which contains a
plan tree for an agent executing a Yellow First Triaging Strategy. The plan
tree is represented as a list of lists data structure using Common Lisp
S-expressions. 

Similarly, `sar-individual-test-prob-grapher.lisp` can be called using the
command,

`$ sbcl --load sar-individual-test-prob-grapher.lisp --quit`

This generates a pdf file, `sar-graph.pdf`, which contains a graphical
visulization of the same plan tree generated by
`sar-individual-test-prob.lisp`.

Plan trace generation
---------------------
The `plan_trace_generation` folder contains code for generating plan traces
(state and action sequences) from the SAR Individual Domain. It is currently
out of date with the current domain. 

Message Conversion Code
-----------------------
`message-conversion.lisp` is a Common Lisp script that simulates converting
json messages from the message bus into SHOP3 state predicates. To run you must
first have downloaded a `<experiment>_messages.json` file to this folder and
have mosquitto, a MQTT message broker. There is also a `elkless_replayer` file in the `tomcat/tools` directory that
simulates message publishing from the message bus, which is a python script and
requires the "paho-mqtt" module (i.e, run `$ pip install paho-mqtt`).

Assuming you have the proper files and set-up, you can then run the commands,

`$ sbcl --load message-conversion.lisp --eval '(initialize-current-goal
"sar-individual-example-goal.txt")' --quit`

`$ mosquitto_sub -t observations/events/player/triage | sbcl --load
message-conversion.lisp --eval '(listen-for-messages)' --quit`

This will create a fresh goal state txt file `sar-individual-current-goal.txt` 
copied from `sar-individual-example-goal.txt` and start the message listener and
feed the incoming messages to the message conversion script. To simulate
messages being published from the message bus, first open another terminal
window and change to the `tomcat/tools` directory and then run,

`$ ./elkless_replayer ../src/lisp/<experiment>_messages.json`

Back in this directory (`tomcat/src/lisp`) you will see that
`sar-individual-current-goal.txt` now includes predicate statements converted
from the json messages.  
